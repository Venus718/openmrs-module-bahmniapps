<div id="messages">
  <p class="success" ng-show="success"><i class="icon-ok-circle white small"></i>File(s) uploaded successfully</p>
</div>

<ul>
  <li id="newVisit" image-gallery="visit-new">
    <h1 ng-click="resetCurrentVisit(newVisit)">
      <i ng-hide="isCurrentVisit(newVisit)" class="icon-plus-sign state"></i>
      <i ng-if="isCurrentVisit(newVisit)" class="icon-minus-sign state"></i>
      Visit: New
    </h1>
    <div ng-if="isCurrentVisit(newVisit)" class="visit-content">
      <form ng-submit="save(newVisit)">
        <div class="form-field">
          <div>
            <label><strong>Visit Type</strong>
              <span class="asterick">*</span>
            </label>
          </div>
          <div class="field-value">
            <select ng-model="newVisit.visitType" ng-options="vt.display for vt in visitTypes" required>
              <option value=""></option>
            </select>
          </div>
        </div>
        <div class="form-field">
          <div>
            <label class="form-attribute"><strong>Start Date</strong>
              <span class="asterick">*</span>
            </label>
          </div>
          <div class="field-value">
            <input type="date" ng-model="newVisit.startDatetime" ng-change="setDefaultEndDate(newVisit)" required class="field-value" placeholder="dd-mm-yyyy">
          </div>
        </div>
        <div class="form-field">
          <div>
            <label class="form-attribute"><strong>End Date</strong></label>
          </div>
          <div class="field-value">
            <input type="date" ng-model="newVisit.stopDatetime" class="field-value" placeholder="dd-mm-yyyy"> 
          </div>
        </div>
        <ul class="files">
          <li class="clear" ng-repeat="image in newVisit.images">
            <div class="file">
              <img image-gallery-item ng-src="{{image.encodedValue}}" title="{{image.getTitle()}}" width="100">
              <input class="concept-name" ng-model="image.concept.name" bahmni-autocomplete source="getConcepts" response-map="getDataResults" on-select="onConceptSelected(image)" required placeholder="Enter the test name" title="Select the test from autocomplete" pattern="{{escapeRegExp(image.concept.name)}}" blur-on-select="true"/>
            </div>
            <div>
              <button type="button" ng-click="newVisit.removeNewAddedImage(image)" class="row-remover"><span class="icon-remove"></span></button>
            </div>
          </li>
        </ul>
        <div class="upload-inline-buttons">
          <input id="file-browse" type="file" name="image" accept="image/*" capture="camera" file-upload visit="newVisit" on-select="setConceptOnImage" default-concept="defaultConcept">
          <label for="file-browse" class="btn btn-primary" ng-click="resetCurrentVisit(newVisit)"><i class="icon-camera icon-white"></i> SCAN</label>
          <button type="submit" ng-disabled="newVisit.images.length == 0" class="btn btn-primary">
            <i class="icon-save icon-white"></i> SAVE
          </button>
        </div>
      </form>
    </div>
  </li>

  <li ng-repeat="visit in visits">
    <h1 ng-click="resetCurrentVisit(visit)">
      <i ng-hide="isCurrentVisit(visit)" class="icon-plus-sign state"></i>
      <i ng-if="isCurrentVisit(visit)" class="icon-minus-sign state"></i>
      Visit: <small>From: </small>
      <span>{{visit.startDatetime | date:'dd-MMM-yy'}}</span>
      <small ng-if="visit.stopDatetime">To: </small>
      <span ng-if="visit.stopDatetime">{{visit.stopDatetime | date:'dd-MMM-yy'}}</span>
      <span ng-if="visit.hasImages()" class="containsImageMarker" title="Visit has images"><i class="icon-picture"></i></span>
      <span ng-if="!visit.stopDatetime" class="currentVisitMarker" title="Current Visit"><i class="icon-star"></i></span>
    </h1>
    <div class="visit-content" ng-if="isCurrentVisit(visit)" image-gallery="visit-{{visit.uuid}}" >
      <form name="{{'visit' + $index}}" ng-submit="save(visit)" ng-disabled="!visit.changed">
        <ul>
          <li>
            <ul class="files">
              <li ng-repeat="image in visit.savedImages">
                <div class="file">
                  <img image-gallery-item title="{{image.getTitle()}}" ng-src="{{image.encodedValue}}" width="100" ng-class="{true:'transparent', false:'opaque'}[image.voided]" />
                  <input name="{{'image'+$index}}" class="concept-name saved" ng-model="image.concept.editableName" bahmni-autocomplete source="getConcepts" response-map="getDataResults" on-select="onConceptSelected(image)" required placeholder="Enter the test name" title="Select the test from autocomplete" pattern="{{escapeRegExp(image.concept.name)}}" blur-on-select="true" ng-change="visit.markAsUpdated()" ng-disabled="image.voided"/>
                </div>
                <div class="file-remove">
                  <button type="button" ng-click="visit.toggleVoidingOfImage(image)" class="row-remover"><span ng-class="{'icon-remove': !image.voided, 'icon-undo': image.voided }"></span></button>
                </div>
              </li> 
              <li ng-repeat="image in visit.images" >
                <div class="file">
                  <img ng-src="{{image.encodedValue}}" image-gallery-item title="{{image.getTitle()}}" width="100">
                  <input class="concept-name" ng-model="image.concept.editableName" bahmni-autocomplete source="getConcepts" response-map="getDataResults" on-select="onConceptSelected(image)" required placeholder="Enter the test name" title="Select the test from autocomplete" pattern="{{escapeRegExp(image.concept.name)}}" blur-on-select="true"/>
                </div>
                <div class="file-remove">
                  <button type="button" ng-click="visit.removeNewAddedImage(image)" class="row-remover"><span class="icon-remove"></span></button>
                </div>
              </li>
              <li>
                <input id="file-browse-{{visit.uuid}}" type="file" name="image" accept="image/*" capture="camera" file-upload visit="visit" on-select="setConceptOnImage" default-concept="defaultConcept">
                <label class="placeholder" for="file-browse-{{visit.uuid}}"><i class="icon-plus"></i></label>
              </li>    
             
              <li>
                <div class="file-actions">
                  <button type="submit" ng-disabled="!visit.changed" class="btn btn-primary">
                    <i class="icon-save icon-white"></i> SAVE
                  </button>
                </div>
              </li>
            </ul>
          </li>
        </ul>
      </form>
    </div>
  </li>
</ul>

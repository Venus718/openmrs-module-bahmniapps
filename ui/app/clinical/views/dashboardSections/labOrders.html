<div ng-controller="PatientDashboardLabOrdersController" class="dashboard-laborders-section">

    <h2 ng-dialog="views/dashboardSections/labSummary.html"
        ng-dialog-class="ngdialog-theme-flat ngdialog-theme-custom"
        ng-dialog-controller="PatientDashboardLabSummaryController" class="section-title">{{section.title}}</h2>
    <section class="block" ng-class="{'more': patientSummary.show}">
        <p class="placeholder-text" ng-if="!hasLabOrders()">{{ patientSummary.message }}</p>

        <div ng-if="hasLabOrders()">
            <table ng-repeat="labOrderResults in labAccessions" bindonce="labAccessions">
                <tbody ng-repeat="labOrderResult in labOrderResults" ng-show="hasAbnormalTests(labOrderResult)">
                    <tr ng-if="labOrderResult.isPanel " class="header">
                        <td colspan="2"><strong>{{labOrderResult.orderName}}</strong></td>
                    </tr>
                    <tr ng-if="labOrderResult.isPanel" ng-repeat="test in labOrderResult.tests" ng-show="test.abnormal">
                        <td class="testUnderPanel" ng-class="{'has-uploaded-file': test.uploadedFileName}">
                            <span ng-if="!test.uploadedFileName" bo-text="test.testName"></span>
                            <span ng-if="test.uploadedFileName"><a class="uploaded-file" href="{{getUploadedFileUrl(test.uploadedFileName)}}" onclick="event.stopPropagation()" target="_blank">{{test.testName}}
                            <span ng-show="test.hasRange" class="range">
                                <span bo-text="'(' + test.minNormal + ' - ' + test.maxNormal + ')'"></span>
                                <span ng-show="test.testUnitOfMeasurement" class="units" bo-text="test.testUnitOfMeasurement"></span>
                            </span>
                            </a></span>
                            <span ng-show="test.hasRange && !test.uploadedFileName" class="range">
                                <span bo-text="'(' + test.minNormal + ' - ' + test.maxNormal + ')'"></span>
                                <span ng-show="test.testUnitOfMeasurement" class="units" bo-text="test.testUnitOfMeasurement"></span>
                            </span>
                        </td>
                        <td class="value has-toggle-btn">
                            <span ng-class="{'referred-out': test.referredOut}">
                                <span class="referred">R</span>
                            </span>
                            <span ng-show="test.result" ng-class="{'is-abnormal': test.abnormal}" class="value" bo-text="test.result"></span>
                            <span class="fr date">
                                <i class="icon-file-alt" ng-show="test.notes"></i>    
                                <span>{{ test.accessionDateTime | date :'dd MMM yy'}}</span>
                            </span>
                        </td>
                    </tr>

                    <tr ng-if="!labOrderResult.isPanel">
                        <td ng-class="{'has-uploaded-file': labOrderResult.uploadedFileName}">
                            <span ng-if="!labOrderResult.uploadedFileName" bo-text="labOrderResult.testName"></span>
                            <span ng-if="labOrderResult.uploadedFileName"><a class="uploaded-file" href="{{getUploadedFileUrl(labOrderResult.uploadedFileName)}}" target="_blank">{{labOrderResult.testName}}
                            <span ng-show="labOrderResult.hasRange" class="range">
                                <span bo-text="'(' + labOrderResult.minNormal + ' - ' + labOrderResult.maxNormal + ')'"></span>
                                <span ng-show="labOrderResult.testUnitOfMeasurement" class="units" bo-text="labOrderResult.testUnitOfMeasurement"></span>
                            </span>
                            </a></span>
                            <span ng-show="labOrderResult.hasRange && !labOrderResult.uploadedFileName" class="range">
                                <span bo-text="'(' + labOrderResult.minNormal + ' - ' + labOrderResult.maxNormal + ')'"></span>
                                <span ng-show="labOrderResult.testUnitOfMeasurement" class="units" bo-text="labOrderResult.testUnitOfMeasurement"></span>
                            </span>
                        </td>
                        <td class="value has-toggle-btn">
                            <span ng-class="{'referred-out': labOrderResult.referredOut}">
                                <span class="referred">R</span>
                            </span>
                            <span ng-show="labOrderResult.result" ng-class="{'is-abnormal': labOrderResult.abnormal}" class="value" bo-text="labOrderResult.result"></span>
                            <span class="fr date">
                                <i class="icon-file-alt" ng-show="labOrderResult.notes"></i>    
                                <span>{{ labOrderResult.accessionDateTime | date :'dd MMM yy'}}</span>
                            </span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section>
</div>
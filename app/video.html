<!DOCTYPE html>
<html>
<head>
    <title>Video playback</title>
</head>
<body>
<video id="live" autoplay></video>
<button id="click" onclick="JavaSCript:ClickImage()" autofocus>Press to Click photo</button>
<button id="ConfirmImage" onclick="JavaSCript:ConfirmImage()" disabled >Confirm Patient Image</button>
<br>
<canvas id="patientImage" width="300" height="300"></canvas>

<script>
    function hasGetUserMedia() {
        // Note: Opera is unprefixed.
        return !!(navigator.mozGetUserMedia || navigator.webkitGetUserMedia ||
                navigator.getUserMedia || navigator.msGetUserMedia);
    }

    if (hasGetUserMedia()) {
        // Good to go!
    } else {
        alert('getUserMedia() is not supported in your browser');
    }

    var x = function(){alert('hi');};

    var ourGetUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;

    var onFailSoHard = function (e) {
        console.log('Reeeejected!', e);
    };

    // Not showing vendor prefixes.
    ourGetUserMedia.apply(navigator, [
        {video: true, audio: false},
        function (localMediaStream) {
            var video = document.querySelector('video');
            video.src = window.URL.createObjectURL(localMediaStream);

            // Note: onloadedmetadata doesn't fire in Chrome when using it with getUserMedia.
            // See crbug.com/110938.
            video.onloadedmetadata = function (e) {
                // Ready to go. Do some stuff.
            };
        },
        onFailSoHard
    ]);

    function ClickImage(){
        var video  = document.getElementById('live');
        var canvas = document.getElementById('patientImage');
        var patientImage = canvas.getContext('2d');
        patientImage.drawImage(video, 0, 0, 300,300);
        document.getElementById('ConfirmImage').removeAttribute('disabled')
        document.getElementById('ConfirmImage').focus();
    };

    function ConfirmImage(){
        var dataURL = document.getElementById('patientImage').toDataURL("image/jpeg");
        //dataURL saved in localStorage to be sent via REST
        localStorage.setItem("patientImage",dataURL);
        localStorage.setItem("patientImageTaken",true);
        //Confirmed Patient Image set on Patient Registration Page-1
        document.getElementById('ConfirmedPatientImage').src= dataURL;
        // Ext.getCmp('photo').hide();

    };


</script>
</div>
</body>
</html>